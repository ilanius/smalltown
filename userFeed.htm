<!doctype html>
<html>
<head>
<?php require 'head.htm'; ?>

<script>
  function gid(id) { return document.getElementById(id); }
  function insertInput( pId ) {
    e = gid( 'comm_' + pId);
    e.innerHTML = '<input type="text" id="omm_'+pId+'" name="omm_'+pId+'" placeholder="opinion" onkeyUp="postIt(event, this);">';
    gid( 'omm_'+pId ).focus();
  }
  function setIt( o ) {
    e = gid( 'c' + o.name );
    e.innerHTML = o.value;
  }  
  function postIt( e, o ) {
    // We need root user id, ruId, here. when we post on someone elses feed
    if ( e.keyCode != 13 || o.value == '' ) return;
    e.preventDefault();
    // alert( e.keyCode + ' ' + o.value + ' ' + o.name );    
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
        setIt( o );
      }
    };
    var val = o.name.substring(4);    
    xhttp.open("POST", "index.php", true);
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send("func=userPost0&ppId="+val+"&pTxt="+ o.value );
  }
</script>
</head>

<body class="feed">
  <div class="headPane"> <!-- flex box here -->
    <a href="?func=userFeedProfil">Logo</a> &nbsp; 
    <form action="?func=userSearch" method="post">
      <input type="text" name="search" id="search" class="search" placeholder="search">
    </form>
    <a href="?func=userAccount"> Konto </a> 
    <a href="?func=userFeedProfile"> Me </a> <a href="?func=userLogout">Logout</a>
  </div>

  <div class="contPane"> 
    <span onclick="insertInput('');"> -comment- </span>
    <span class="postComment" id="comm_">  </span> 
    
    <?php
    function createFeed( &$posts, &$feed  ) {
      if ( sizeof( $posts ) == 0 ) return;
      foreach( $posts as &$p ) {
        $feed = $feed . "
        <div class='post'>
          <div class='pTxt'>$p[uId]: $p[pTxt] </div>
          <span id=\"emot_$p[pId]\" onclick=\"alert($p[pId])\"> -like/dislike- </span>
          <span onclick=\"insertInput($p[pId])\"> -comment- </span>\n";
        createFeed( $p['child'], $feed );
        $feed = $feed . "
        <span class=\"postComment\" id=\"comm_$p[pId]\">  </span> \n
        </div>";
      }
    }
    $feed = "";
    createFeed( $R['posts'], $feed );
    echo $feed;
    ?>
  <div class="footPane"> 
      Debug stmnt1: <?=$R['stmnt1']?> <br>
      Debug stmnt2: <?=$R['stmnt2']?> 
  </div>

</body>
</html>
